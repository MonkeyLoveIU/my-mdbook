<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>éƒ¨ç½² - æœ• çš„ å› å¿† å½•</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../theme/custom.css">
        <link rel="stylesheet" href="../theme/pagetoc.css">


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "../searchindex.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>â†</kbd> or <kbd>â†’</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">æœ• çš„ å› å¿† å½•</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <i class="fa fa-spinner fa-spin"></i>
                            </div>
                        </div>
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="äº‘æœåŠ¡å™¨ä¸Šä¸­æ–‡æƒ…æ„Ÿåˆ†ç±»æ¨¡å‹å¾®è°ƒä¸éƒ¨ç½²å…¨æµç¨‹å®æˆ˜"><a class="header" href="#äº‘æœåŠ¡å™¨ä¸Šä¸­æ–‡æƒ…æ„Ÿåˆ†ç±»æ¨¡å‹å¾®è°ƒä¸éƒ¨ç½²å…¨æµç¨‹å®æˆ˜">äº‘æœåŠ¡å™¨ä¸Šä¸­æ–‡æƒ…æ„Ÿåˆ†ç±»æ¨¡å‹å¾®è°ƒä¸éƒ¨ç½²å…¨æµç¨‹å®æˆ˜</a></h1>
<h2 id="ç›®å½•"><a class="header" href="#ç›®å½•">ç›®å½•</a></h2>
<ol>
<li><a href="#%E9%A1%B9%E7%9B%AE%E4%BB%8B%E7%BB%8D">é¡¹ç›®ä»‹ç»</a></li>
<li><a href="#%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87">ç¯å¢ƒå‡†å¤‡</a></li>
<li><a href="#%E6%95%B0%E6%8D%AE%E5%87%86%E5%A4%87">æ•°æ®å‡†å¤‡</a></li>
<li><a href="#%E6%A8%A1%E5%9E%8B%E5%BE%AE%E8%B0%83">æ¨¡å‹å¾®è°ƒ</a></li>
<li><a href="#gradio-%E5%89%8D%E7%AB%AF%E6%90%AD%E5%BB%BA">Gradio å‰ç«¯æ­å»º</a></li>
<li><a href="#%E5%85%AC%E7%BD%91%E8%AE%BF%E9%97%AE%E4%B8%8E%E9%9A%A7%E9%81%93%E5%B7%A5%E5%85%B7-ngrok">å…¬ç½‘è®¿é—®ä¸éš§é“å·¥å…· ngrok</a></li>
<li><a href="#%E6%80%BB%E7%BB%93%E4%B8%8E%E6%89%A9%E5%B1%95">æ€»ç»“ä¸æ‰©å±•</a></li>
<li><a href="#%E9%A1%B9%E7%9B%AE%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84">é¡¹ç›®æ–‡ä»¶ç»“æ„</a></li>
</ol>
<hr />
<h2 id="é¡¹ç›®ä»‹ç»"><a class="header" href="#é¡¹ç›®ä»‹ç»">é¡¹ç›®ä»‹ç»</a></h2>
<p>æœ¬é¡¹ç›®æ—¨åœ¨æ¼”ç¤ºå¦‚ä½•åœ¨è…¾è®¯äº‘æœåŠ¡å™¨ä¸Šå®Œæˆä¸­æ–‡æƒ…æ„Ÿåˆ†ç±»æ¨¡å‹çš„å¾®è°ƒå’Œåœ¨çº¿éƒ¨ç½²ï¼Œæ¶µç›–ä»æ•°æ®å‡†å¤‡ã€æ¨¡å‹è®­ç»ƒã€æœåŠ¡æ­å»ºåˆ°å…¬ç½‘è®¿é—®çš„å®Œæ•´æŠ€æœ¯æµç¨‹ã€‚<br />
æ ¸å¿ƒæŠ€æœ¯æ ˆåŒ…æ‹¬ Huggingface Transformersã€Datasetsã€Gradio å’Œ ngrokã€‚</p>
<hr />
<h2 id="ç¯å¢ƒå‡†å¤‡"><a class="header" href="#ç¯å¢ƒå‡†å¤‡">ç¯å¢ƒå‡†å¤‡</a></h2>
<ul>
<li>äº‘æœåŠ¡å™¨æ“ä½œç³»ç»Ÿï¼šUbuntu 20.04</li>
<li>Python 3.8 åŠä»¥ä¸Šç‰ˆæœ¬</li>
<li>ä¾èµ–åŒ…å®‰è£…å‘½ä»¤ï¼š</li>
</ul>
<pre><code class="language-bash">apt update &amp;&amp; apt install -y python3 python3-pip git 


# å®‰è£… GPU æ”¯æŒçš„æ·±åº¦å­¦ä¹ æ¡†æ¶

# ä»¥ PyTorch ä¸ºä¾‹ï¼ˆCUDA 12.4 å¯¹åº”ç‰ˆæœ¬ï¼‰
pip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu124 


pip install transformers datasets accelerate




---

## æ•°æ®å‡†å¤‡


æ–°å»ºä¸€ä¸ª `test_model.py`ï¼š

```python
from transformers import pipeline

# åŠ è½½ä¸­æ–‡æƒ…æ„Ÿåˆ†ææ¨¡å‹
classifier = pipeline(
    "sentiment-analysis",
    model="uer/roberta-base-finetuned-jd-binary-chinese",
    device=0  # GPU:0
)

# æµ‹è¯•å‡ å¥è¯
texts = [
    "è¿™ä¸ªäº§å“çœŸçš„å¾ˆå¥½ç”¨ï¼",
    "æˆ‘éå¸¸å¤±æœ›ï¼Œè´¨é‡å¤ªå·®äº†ã€‚",
    "ä¸€èˆ¬èˆ¬ï¼Œæ²¡æœ‰ç‰¹åˆ«æƒŠè‰³çš„åœ°æ–¹ã€‚"
]

for t in texts:
    print(t, "=&gt;", classifier(t))
</code></pre>
<p>è¿è¡Œï¼š</p>
<pre><code class="language-bash">python test_model.py
</code></pre>
<p>ä½ ä¼šçœ‹åˆ°ä¸‰å¥è¯åˆ†åˆ«è¢«æ ‡æ³¨ä¸ºç§¯æï¼ˆpositiveï¼‰æˆ–æ¶ˆæï¼ˆnegativeï¼‰ã€‚</p>
<p>è¿™ä¸ªäº§å“çœŸçš„å¾ˆå¥½ç”¨ï¼ =&gt; [{'label': 'positive (stars 4 and 5)', 'score': 0.976917028427124}]
model.safetensors:   5%|â–ˆâ–ˆâ–ˆâ–ˆâ–‹                                                                                       | 21.0M/409M [00:01&lt;00:21, 18.3MB/s]æˆ‘éå¸¸å¤±æœ›ï¼Œè´¨é‡å¤ªå·®äº†ã€‚ =&gt; [{'label': 'negative (stars 1, 2 and 3)', 'score': 0.9843776226043701}]
ä¸€èˆ¬èˆ¬ï¼Œæ²¡æœ‰ç‰¹åˆ«æƒŠè‰³çš„åœ°æ–¹ã€‚ =&gt; [{'label': 'negative (stars 1, 2 and 3)', 'score': 0.5168154239654541}]
model.safetensors: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 409M/409M [00:33&lt;00:00, 12.2MB/s]</p>
<h2 id="æ¨¡å‹å¾®è°ƒ"><a class="header" href="#æ¨¡å‹å¾®è°ƒ">æ¨¡å‹å¾®è°ƒ</a></h2>
<p>æˆ‘ä»¬è¿›å…¥ <strong>é˜¶æ®µ 3ï¼šå¾®è°ƒæ¨¡å‹</strong>ï¼Œä¸€æ­¥æ­¥æ¥ã€‚</p>
<hr />
<h2 id="-é˜¶æ®µ-3å¾®è°ƒä¸­æ–‡æƒ…æ„Ÿåˆ†ææ¨¡å‹"><a class="header" href="#-é˜¶æ®µ-3å¾®è°ƒä¸­æ–‡æƒ…æ„Ÿåˆ†ææ¨¡å‹"><strong>ğŸ“Œ é˜¶æ®µ 3ï¼šå¾®è°ƒä¸­æ–‡æƒ…æ„Ÿåˆ†ææ¨¡å‹</strong></a></h2>
<h3 id="1-å®‰è£…ä¾èµ–"><a class="header" href="#1-å®‰è£…ä¾èµ–">1. å®‰è£…ä¾èµ–</a></h3>
<p>å…ˆå®‰è£… Hugging Face è®­ç»ƒæ‰€éœ€å·¥å…·ï¼š</p>
<pre><code class="language-bash">pip install transformers datasets accelerate evaluate
</code></pre>
<hr />
<h3 id="2-åˆ›å»ºè®­ç»ƒè„šæœ¬-finetune_sentimentpy"><a class="header" href="#2-åˆ›å»ºè®­ç»ƒè„šæœ¬-finetune_sentimentpy">2. åˆ›å»ºè®­ç»ƒè„šæœ¬ <code>finetune_sentiment.py</code></a></h3>
<details>
  <summary>ä»£ç </summary>
<pre><code class="language-python">from datasets import Dataset
import pandas as pd
import evaluate
import numpy as np
from transformers import AutoTokenizer, AutoModelForSequenceClassification, TrainingArguments, Trainer

# 1. è¯»å– CSV å¹¶è½¬æˆ Dataset
df = pd.read_csv("data/chnsenticorp.csv")  # ç¡®ä¿æ–‡ä»¶è·¯å¾„æ­£ç¡®
dataset = Dataset.from_pandas(df)

# 2. æ‹†åˆ†æ•°æ®é›†ï¼ˆ80%è®­ç»ƒï¼Œ20%éªŒè¯ï¼‰
split_dataset = dataset.train_test_split(test_size=0.2, seed=42)
train_dataset = split_dataset["train"]
eval_dataset = split_dataset["test"]

# 3. åŠ è½½åˆ†è¯å™¨å’Œæ¨¡å‹
model_name = "uer/roberta-base-finetuned-jd-binary-chinese"
tokenizer = AutoTokenizer.from_pretrained(model_name)
model = AutoModelForSequenceClassification.from_pretrained(model_name)

# 4. å®šä¹‰åˆ†è¯å‡½æ•°
def preprocess_function(examples):
    return tokenizer(examples["text"], truncation=True, padding="max_length", max_length=128)

# 5. å¯¹è®­ç»ƒé›†å’ŒéªŒè¯é›†åšåˆ†è¯
train_dataset = train_dataset.map(preprocess_function, batched=True)
eval_dataset = eval_dataset.map(preprocess_function, batched=True)

# 6. åŠ è½½è¯„ä»·æŒ‡æ ‡
accuracy = evaluate.load("accuracy")

def compute_metrics(eval_pred):
    logits, labels = eval_pred
    predictions = np.argmax(logits, axis=-1)
    return accuracy.compute(predictions=predictions, references=labels)

# 7. è®­ç»ƒå‚æ•°é…ç½®
training_args = TrainingArguments(
    output_dir="./results",
    save_strategy="epoch",
    learning_rate=2e-5,
    per_device_train_batch_size=16,
    per_device_eval_batch_size=16,
    num_train_epochs=2,
    weight_decay=0.01,
    logging_dir="./logs",
    logging_steps=50,
    push_to_hub=False,
    load_best_model_at_end=False,
    fp16=True
)

# 8. åˆ›å»º Trainer å®ä¾‹
trainer = Trainer(
    model=model,
    args=training_args,
    train_dataset=train_dataset,
    eval_dataset=eval_dataset,
    tokenizer=tokenizer,
    compute_metrics=compute_metrics
)

# 9. å¼€å§‹è®­ç»ƒ
trainer.train()

# 10. ä¿å­˜æ¨¡å‹å’Œåˆ†è¯å™¨
trainer.save_model("./my-chinese-sentiment")
tokenizer.save_pretrained("./my-chinese-sentiment")

print("âœ… è®­ç»ƒå®Œæˆï¼Œæ¨¡å‹å·²ä¿å­˜åˆ° ./my-chinese-sentiment")


</code></pre>
<p>è¿è¡Œï¼š</p>
<pre><code class="language-bash">python test_my_model.py
</code></pre>
</details>
<p>æ‰§è¡Œ <strong>python finetune_sentiment.py</strong>æŠ¥é”™</p>
<details>
  <summary>æŠ¥é”™è§£é‡Š</summary>
<p>ä½ è¿™ä¸ªæŠ¥é”™æ˜¯å› ä¸º load_dataset("chnsenticorp") ä¼šå» Hugging Face Hub ä¸‹è½½ä¸­æ–‡æƒ…æ„Ÿæ•°æ®é›†ï¼Œä½†æœåŠ¡å™¨ç°åœ¨è¿ä¸ä¸Š Hugging Faceï¼ˆè¦ä¹ˆæ˜¯ç½‘ç»œè¢«å¢™ï¼Œè¦ä¹ˆæ˜¯æ²¡æœ‰è®¾ç½®è®¿é—® tokenï¼‰</p>
</details>
<p>è§£å†³åŠæ³•</p>
<details>
  <summary>è§£å†³æ–¹æ³•</summary>
<hr />
<p><strong>æ–¹æ³• 1ï¼šæ‰‹åŠ¨ä¸‹è½½æœ¬åœ°æ•°æ®é›†ï¼ˆæ¨èï¼Œç¨³å®šï¼‰</strong></p>
<ol>
<li>æˆ‘å¸®ä½ æ‰¾å¥½ <code>ChnSentiCorp</code> æ•°æ®é›†çš„ CSV æ–‡ä»¶ï¼ˆåŒ…å«â€œè¯„è®ºâ€å’Œâ€œæ ‡ç­¾â€ï¼‰ï¼Œæˆ‘ä»¬ç›´æ¥ç”¨ <code>pandas</code> è¯»æœ¬åœ°æ•°æ®ï¼Œä¸èµ° Hugging Face Hubã€‚</li>
<li>ä½ æŠŠæ–‡ä»¶æ”¾åˆ° <code>/workspace/data/</code> ä¸‹ï¼Œè„šæœ¬æ”¹æˆï¼š</li>
</ol>
<pre><code class="language-python">from datasets import Dataset
import pandas as pd

df = pd.read_csv("data/chnsenticorp.csv")  # å‡è®¾æœ‰ text, label ä¸¤åˆ—
dataset = Dataset.from_pandas(df)
</code></pre>
<p>è¿™æ ·å®Œå…¨ä¸ç”¨è”ç½‘ã€‚</p>
<hr />
<p><strong>æ–¹æ³• 2ï¼šé…ç½® Hugging Face å›½å†…é•œåƒ</strong>ï¼ˆå¦‚æœè¦ç»§ç»­ç”¨ Hubï¼‰</p>
<pre><code class="language-bash">pip install huggingface_hub
huggingface-cli login  # å¦‚æœä½ æœ‰ HF è´¦å·ï¼Œè¾“å…¥ token
</code></pre>
<p>ç„¶ååœ¨ Python é‡ŒåŠ ï¼š</p>
<pre><code class="language-python">from datasets import load_dataset
dataset = load_dataset("shibing624/chnsenticorp")
</code></pre>
<p><code>shibing624/chnsenticorp</code> æ˜¯ç¤¾åŒºä¸Šä¼ çš„ç‰ˆæœ¬ï¼Œæ¯”å®˜æ–¹çš„æ›´å®¹æ˜“ä¸‹è½½ã€‚
ä½†å‰ææ˜¯ä½ çš„æœåŠ¡å™¨èƒ½ç§‘å­¦è®¿é—®ã€‚</p>
<hr />
<p><strong>æ–¹æ³• 3ï¼šæ¢ä¸€ä¸ªæœ¬åœ°å¯ç”¨çš„ä¸­æ–‡æƒ…æ„Ÿæ•°æ®é›†</strong>
æ¯”å¦‚ç›´æ¥ç”¨å‡ ç™¾æ¡ç¤ºä¾‹æ•°æ®ç»ƒæ‰‹ï¼Œå…ˆè·‘é€šæµç¨‹ï¼Œå†æ¢æ›´å¤§çš„æ•°æ®ã€‚</p>
<hr />
<p>æˆ‘èµ°çš„æ˜¯ <strong>æ–¹æ³• 1ï¼ˆæœ¬åœ°æ•°æ®ï¼‰</strong>ï¼Œè¿™æ ·æˆ‘ä»¬é©¬ä¸Šå°±èƒ½å¼€å§‹å¾®è°ƒï¼Œä¸ç”¨æŠ˜è…¾ç½‘ç»œã€‚</p>
</details>
<p>å°†ä»¥ä¸‹æ•°æ®å†™å…¥<code>chnsenticorp.csv</code> æ–‡ä»¶å†…å®¹ï¼Œç„¶åæŠŠå®ƒä¿å­˜åˆ° <code>/workspace/data/chnsenticorp.csv</code> å°±å¯ä»¥äº†ã€‚</p>
<details>
  <summary>ç¤ºä¾‹å†…å®¹</summary>
<p>è¿™é‡Œæ˜¯ç¤ºä¾‹å†…å®¹ï¼ŒåŒ…å«å‡ æ¡ä¸­æ–‡æƒ…æ„Ÿåˆ†ç±»çš„æ ·æœ¬ï¼Œæ ¼å¼æ˜¯ <code>text,label</code>ï¼Œlabel 1 è¡¨ç¤ºç§¯æï¼Œ0 è¡¨ç¤ºæ¶ˆæï¼š</p>
<pre><code class="language-csv">text,label
è¿™ä¸ªäº§å“çœŸçš„å¾ˆå¥½ç”¨,1
è´¨é‡å¤ªå·®äº†ï¼Œéå¸¸å¤±æœ›,0
æœåŠ¡æ€åº¦éå¸¸å¥½ï¼Œå€¼å¾—æ¨è,1
ä¸å–œæ¬¢è¿™ä¸ªå•†å“ï¼Œä½“éªŒå¾ˆå·®,0
ç‰©ç¾ä»·å»‰ï¼Œè¶…å‡ºé¢„æœŸ,1
åƒåœ¾ï¼Œå®Œå…¨æ²¡æœ‰ç”¨,0
å¿«é€’å¾ˆå¿«ï¼ŒåŒ…è£…ä¹Ÿä¸é”™,1
å·®è¯„ï¼Œæ ¹æœ¬ä¸å€¼è¿™ä¸ªä»·æ ¼,0
ç”¨äº†å‡ å¤©æ‰å‘ç°éå¸¸å¥½ç”¨ï¼Œæ»¡æ„,1
é¢œè‰²å’Œå›¾ç‰‡ä¸€æ ·ï¼Œéå¸¸æ¼‚äº®,1
å®‰è£…å¤æ‚ï¼Œè¯´æ˜ä¹¦ä¸è¯¦ç»†,0
å®¢æœæ€åº¦å†·æ·¡ï¼Œä¸æƒ³ä¹°äº†,0
æ€§ä»·æ¯”é«˜ï¼Œä¸‹æ¬¡è¿˜ä¼šä¹°,1
ä¸œè¥¿åäº†ï¼Œé€€è´§éº»çƒ¦,0
ç‰©æµæ…¢å¾—è®©äººå¿ƒç„¦,0
ä½“éªŒå¾ˆå¥½ï¼Œæ“ä½œç®€å•,1
è®¾è®¡æ—¶å°šï¼Œæ‰‹æ„Ÿä¸é”™,1
æ²¡æœ‰é¢„æœŸçš„å¥½ï¼Œå¤±æœ›,0
åŒ…è£…ç ´æŸï¼Œå½±å“å¿ƒæƒ…,0
ä»·æ ¼åˆç†ï¼Œåˆ’ç®—,1
äº§å“æè´¨å¾ˆå·®ï¼Œæ„Ÿè§‰ä¾¿å®œè´§,0
å®¢æœè€å¿ƒè§£ç­”ï¼Œè§£å†³äº†é—®é¢˜,1
æ”¶åˆ°è´§åå¾ˆæ»¡æ„ï¼Œéå¸¸æ£’,1
å¿«é€’å‘˜æ€åº¦å·®ï¼Œå½±å“å¿ƒæƒ…,0
è´¨é‡éå¸¸å¥½ï¼Œè¶…å‡ºé¢„æœŸ,1
äº§å“æœ‰å¼‚å‘³ï¼Œä¸å»ºè®®è´­ä¹°,0
ä½¿ç”¨æ–¹ä¾¿ï¼Œæ•ˆæœæ˜æ˜¾,1
é€€è´§è¿‡ç¨‹ç¹çï¼Œæµªè´¹æ—¶é—´,0
éå¸¸å–œæ¬¢ï¼Œæ¨èè´­ä¹°,1
åŠŸèƒ½é½å…¨ï¼Œæ“ä½œæµç•…,1

</code></pre>
</details>
<p>æ‰§è¡Œ</p>
<p>âœ… è®­ç»ƒå®Œæˆï¼Œæ¨¡å‹å·²ä¿å­˜åˆ° ./my-chinese-sentiment</p>
<p>åŠ è½½åˆšè®­ç»ƒå¥½çš„æ¨¡å‹å’Œåˆ†è¯å™¨ï¼Œç»™ä¸€å¥ä¸­æ–‡æ–‡æœ¬åšæƒ…æ„Ÿé¢„æµ‹ï¼š</p>
<details>
  <summary>ä»£ç ç¤ºä¾‹</summary>
<pre><code class="language-python">from transformers import AutoTokenizer, AutoModelForSequenceClassification
import torch
import numpy as np

# 1. åŠ è½½è®­ç»ƒåä¿å­˜çš„æ¨¡å‹å’Œåˆ†è¯å™¨
model_dir = "./my-chinese-sentiment"
tokenizer = AutoTokenizer.from_pretrained(model_dir)
model = AutoModelForSequenceClassification.from_pretrained(model_dir)

# 2. å‡†å¤‡è¾“å…¥æ–‡æœ¬
text = "è¿™ä¸ªäº§å“çœŸçš„å¾ˆå¥½ç”¨ï¼Œæˆ‘å¾ˆå–œæ¬¢ï¼"

# 3. åˆ†è¯ç¼–ç 
inputs = tokenizer(text, return_tensors="pt", truncation=True, padding="max_length", max_length=128)

# 4. æ¨¡å‹æ¨ç†
model.eval()
with torch.no_grad():
    outputs = model(**inputs)
    logits = outputs.logits

# 5. å–æ¦‚ç‡æœ€é«˜çš„ç±»åˆ«ç´¢å¼•
predicted_class_id = torch.argmax(logits, dim=1).item()

# 6. è¾“å‡ºç»“æœï¼ˆ0=æ¶ˆæï¼Œ1=ç§¯æï¼‰
labels_map = {0: "æ¶ˆæ", 1: "ç§¯æ"}
print(f"æ–‡æœ¬ï¼š{text}")
print(f"é¢„æµ‹æƒ…æ„Ÿï¼š{labels_map[predicted_class_id]}")
</code></pre>
<hr />
<p>æŠŠè¿™æ®µä»£ç ä¿å­˜æˆæ¯”å¦‚ <code>predict.py</code>ï¼Œæ‰§è¡Œï¼š</p>
<pre><code class="language-bash">python predict.py
</code></pre>
<p>å°±èƒ½çœ‹åˆ°æ¨¡å‹å¯¹ç¤ºä¾‹æ–‡æœ¬çš„æƒ…æ„Ÿé¢„æµ‹ç»“æœäº†ã€‚</p>
<h2>(base) root@VM-14-154-ubuntu:/workspace# python predict.py
æ–‡æœ¬ï¼šè¿™ä¸ªäº§å“çœŸçš„å¾ˆå¥½ç”¨ï¼Œæˆ‘å¾ˆå–œæ¬¢ï¼
é¢„æµ‹æƒ…æ„Ÿï¼šç§¯æ</h2>
</details>
<h3 id="å¾®è°ƒæ–¹æ¡ˆ"><a class="header" href="#å¾®è°ƒæ–¹æ¡ˆ">å¾®è°ƒæ–¹æ¡ˆ</a></h3>
<details>
  <summary>æ–¹æ¡ˆ</summary>
å› ä¸ºç”¨çš„æ˜¯ Hugging Face Transformers è®­ç»ƒçš„ä¸­æ–‡æƒ…æ„Ÿåˆ†ç±»æ¨¡å‹ï¼Œæƒ³ç”¨ç±»ä¼¼ **LLaMA-Factory** çš„å¸¦ Web UI çš„å·¥å…·æ¥å¾®è°ƒå®ƒï¼Œä»¥ä¸‹æ˜¯å¯è¡Œæ–¹æ¡ˆå’Œæ€è·¯ï¼š
<hr />
<h2 id="1-llama-factory-ui-æ˜¯ä¸“é—¨é’ˆå¯¹-llama-ç³»åˆ—å¤§è¯­è¨€æ¨¡å‹è®¾è®¡çš„"><a class="header" href="#1-llama-factory-ui-æ˜¯ä¸“é—¨é’ˆå¯¹-llama-ç³»åˆ—å¤§è¯­è¨€æ¨¡å‹è®¾è®¡çš„">1. LLaMA-Factory UI æ˜¯ä¸“é—¨é’ˆå¯¹ LLaMA ç³»åˆ—å¤§è¯­è¨€æ¨¡å‹è®¾è®¡çš„</a></h2>
<ul>
<li>å®ƒé›†æˆäº†è®­ç»ƒã€æ¨ç†çš„ Web ç•Œé¢</li>
<li>æ”¯æŒ LoRA / QLoRA å¾®è°ƒç­‰</li>
<li>ä¸»è¦é¢å‘ç”Ÿæˆä»»åŠ¡å’Œå¤§æ¨¡å‹ï¼Œä¸ç›´æ¥æ”¯æŒä¸€èˆ¬ Transformers åˆ†ç±»æ¨¡å‹å¾®è°ƒ</li>
</ul>
<hr />
<h2 id="2-ä½ çš„æ¨¡å‹åŸºäº-robertaå¾®è°ƒ--ui-æ–¹æ¡ˆ"><a class="header" href="#2-ä½ çš„æ¨¡å‹åŸºäº-robertaå¾®è°ƒ--ui-æ–¹æ¡ˆ">2. ä½ çš„æ¨¡å‹ï¼ˆåŸºäº RoBERTaï¼‰å¾®è°ƒ + UI æ–¹æ¡ˆ</a></h2>
<h3 id="æ–¹æ¡ˆ-aç”¨-gradio-æˆ–-streamlit-è‡ªå·±æ­å»ºç®€å•çš„-web-ui"><a class="header" href="#æ–¹æ¡ˆ-aç”¨-gradio-æˆ–-streamlit-è‡ªå·±æ­å»ºç®€å•çš„-web-ui">æ–¹æ¡ˆ Aï¼šç”¨ Gradio æˆ– Streamlit è‡ªå·±æ­å»ºç®€å•çš„ Web UI</a></h3>
<ul>
<li><strong>Gradio</strong> æ˜¯å¾ˆæµè¡Œçš„ Python åº“ï¼Œå¯ä»¥ç”¨å‡ è¡Œä»£ç å¿«é€Ÿåšä¸€ä¸ªç½‘é¡µç•Œé¢ï¼Œæ—¢èƒ½æ¨ç†ä¹Ÿèƒ½è§¦å‘è®­ç»ƒ</li>
<li>ä½ å¯ä»¥æŠŠè®­ç»ƒè„šæœ¬æ”¹æˆå‡½æ•°ï¼Œå‰ç«¯ä¼ å…¥è®­ç»ƒå‚æ•°å’Œæ•°æ®ï¼Œåå°è°ƒç”¨ Hugging Face Trainer è®­ç»ƒï¼Œæ¨ç†éƒ¨åˆ†ç”¨ä½ å·²ä¿å­˜æ¨¡å‹åŠ è½½åšé¢„æµ‹</li>
</ul>
<p>ç¤ºä¾‹ï¼šç®€æ˜“æ¨ç† + è®­ç»ƒæŒ‰é’®ç•Œé¢ï¼ˆå¯æ‰©å±•ï¼‰</p>
<pre><code class="language-python">import gradio as gr
from transformers import AutoTokenizer, AutoModelForSequenceClassification, Trainer, TrainingArguments
import torch
import pandas as pd

model_dir = "./my-chinese-sentiment"
tokenizer = AutoTokenizer.from_pretrained(model_dir)
model = AutoModelForSequenceClassification.from_pretrained(model_dir)

def predict(text):
    inputs = tokenizer(text, return_tensors="pt", truncation=True, padding=True, max_length=128)
    outputs = model(**inputs)
    probs = torch.softmax(outputs.logits, dim=-1)
    label = torch.argmax(probs).item()
    return "ç§¯æ" if label == 1 else "æ¶ˆæ"

def train(data_csv):
    # è¿™é‡Œç®€å•ç¤ºèŒƒï¼šæ¥æ”¶ CSV æ–‡ä»¶è·¯å¾„ï¼Œè¿è¡Œè®­ç»ƒè„šæœ¬æˆ–è°ƒç”¨ Trainer
    df = pd.read_csv(data_csv.name)
    # ä½ å¯ä»¥å†™å®Œæ•´çš„è®­ç»ƒæµç¨‹ï¼Œå‚è€ƒä¹‹å‰ä»£ç 
    return "è®­ç»ƒå·²å®Œæˆï¼"

with gr.Blocks() as demo:
    gr.Markdown("# ä¸­æ–‡æƒ…æ„Ÿåˆ†ç±»å¾®è°ƒä¸é¢„æµ‹")
    text_input = gr.Textbox(label="è¾“å…¥æ–‡æœ¬é¢„æµ‹æƒ…æ„Ÿ")
    pred_button = gr.Button("é¢„æµ‹")
    pred_output = gr.Label()
    
    pred_button.click(predict, inputs=text_input, outputs=pred_output)
    
    file_input = gr.File(label="ä¸Šä¼ è®­ç»ƒæ•°æ® CSV")
    train_button = gr.Button("å¼€å§‹è®­ç»ƒ")
    train_output = gr.Textbox()
    
    train_button.click(train, inputs=file_input, outputs=train_output)

demo.launch()
</code></pre>
<p>ç”¨ <code>python your_gradio_app.py</code> å¯åŠ¨åå°±æœ‰ä¸ªç®€å• UI å¯ä»¥è¯•ã€‚</p>
<hr />
<h3 id="æ–¹æ¡ˆ-bç”¨å·²æœ‰çš„-hugging-face-spaces"><a class="header" href="#æ–¹æ¡ˆ-bç”¨å·²æœ‰çš„-hugging-face-spaces">æ–¹æ¡ˆ Bï¼šç”¨å·²æœ‰çš„ Hugging Face Spaces</a></h3>
<ul>
<li>Hugging Face Spaces æ”¯æŒ Gradio/Streamlitï¼Œå¯ä»¥å¿«é€Ÿéƒ¨ç½²åœ¨çº¿ Web åº”ç”¨</li>
<li>ä½†é€šå¸¸ä¸æ”¯æŒåœ¨çº¿è®­ç»ƒï¼Œåªé€‚åˆæ¨ç†</li>
</ul>
<hr />
<h3 id="æ–¹æ¡ˆ-cä½¿ç”¨ä¸“ä¸š-mlops--automl-å¹³å°"><a class="header" href="#æ–¹æ¡ˆ-cä½¿ç”¨ä¸“ä¸š-mlops--automl-å¹³å°">æ–¹æ¡ˆ Cï¼šä½¿ç”¨ä¸“ä¸š MLOps / AutoML å¹³å°</a></h3>
<ul>
<li>æ¯”å¦‚ Azure ML Studioã€Weights &amp; Biasesã€SageMaker ç­‰</li>
<li>æœ‰å®Œæ•´ç•Œé¢ç®¡ç†è®­ç»ƒã€æ¨ç†å’Œç›‘æ§ï¼Œä½†é…ç½®å’Œæˆæœ¬è¾ƒé«˜</li>
</ul>
<hr />
<h2 id="3-æ€»ç»“"><a class="header" href="#3-æ€»ç»“">3. æ€»ç»“</a></h2>
<ul>
<li><strong>LLaMA-Factory çš„ Web UI</strong> æ˜¯ä¸“é—¨ç»™å¤§è¯­è¨€æ¨¡å‹ç”¨çš„ï¼Œä¸èƒ½ç›´æ¥æ‹¿æ¥è®­ç»ƒ RoBERTa åˆ†ç±»æ¨¡å‹</li>
<li>å¯ä»¥ç”¨ <strong>Gradio</strong> è‡ªå·±å¿«é€Ÿæ­ä¸ªç•Œé¢ï¼Œå®ç°ç®€å•çš„è®­ç»ƒå’Œæ¨ç†äº¤äº’</li>
<li>è®­ç»ƒéƒ¨åˆ†é€»è¾‘å®Œå…¨å¯å¤ç”¨å·²æœ‰çš„ä»£ç ï¼ŒUI åªè´Ÿè´£æ–‡ä»¶ä¸Šä¼ å’Œå‚æ•°ä¼ é€’</li>
</ul>
<hr />
</details>
<h2 id="gradio-å‰ç«¯æ­å»º"><a class="header" href="#gradio-å‰ç«¯æ­å»º">gradio-å‰ç«¯æ­å»º</a></h2>
<p>æˆ‘é‡‡ç”¨æ–¹æ¡ˆAï¼Œä»¥ä¸‹æ˜¯ä¸€ä¸ªåŸºäº <strong>Gradio</strong> çš„ç®€å•ä¸­æ–‡æƒ…æ„Ÿåˆ†ç±»å¾®è°ƒ+æ¨ç† Web UI ç¤ºä¾‹ã€‚è¿™ä¸ªç•Œé¢æ”¯æŒï¼š</p>
<ul>
<li>è¾“å…¥æ–‡æœ¬åšæƒ…æ„Ÿé¢„æµ‹</li>
<li>ä¸Šä¼ æ–°çš„è®­ç»ƒæ•°æ® CSVï¼Œç‚¹å‡»æŒ‰é’®è§¦å‘å¾®è°ƒè®­ç»ƒ</li>
</ul>
<hr />
<details>
  <summary>ç¤ºèŒƒ</summary>
<h3 id="å®Œæ•´ç¤ºèŒƒä»£ç apppy"><a class="header" href="#å®Œæ•´ç¤ºèŒƒä»£ç apppy">å®Œæ•´ç¤ºèŒƒä»£ç ï¼ˆ<code>app.py</code>ï¼‰</a></h3>
<pre><code class="language-python">import gradio as gr
import pandas as pd
import torch
import numpy as np
from transformers import AutoTokenizer, AutoModelForSequenceClassification, Trainer, TrainingArguments
from datasets import Dataset
import evaluate

# åˆå§‹åŠ è½½å·²æœ‰æ¨¡å‹å’Œåˆ†è¯å™¨
model_dir = "./my-chinese-sentiment"
tokenizer = AutoTokenizer.from_pretrained(model_dir)
model = AutoModelForSequenceClassification.from_pretrained(model_dir)

# è¯„ä»·æŒ‡æ ‡
accuracy = evaluate.load("accuracy")

def compute_metrics(eval_pred):
    logits, labels = eval_pred
    predictions = np.argmax(logits, axis=-1)
    return accuracy.compute(predictions=predictions, references=labels)

# é¢„æµ‹å‡½æ•°
def predict(text):
    inputs = tokenizer(text, return_tensors="pt", truncation=True, padding=True, max_length=128)
    model.eval()
    with torch.no_grad():
        outputs = model(**inputs)
        probs = torch.softmax(outputs.logits, dim=-1)
        label = torch.argmax(probs).item()
    return "ç§¯æ" if label == 1 else "æ¶ˆæ"

# è®­ç»ƒå‡½æ•°
def train(file_obj):
    try:
        df = pd.read_csv(file_obj.name)
        if "text" not in df.columns or "label" not in df.columns:
            return "CSVå¿…é¡»åŒ…å«'text'å’Œ'label'ä¸¤åˆ—"
        
        dataset = Dataset.from_pandas(df)
        split_ds = dataset.train_test_split(test_size=0.2, seed=42)
        train_ds = split_ds["train"]
        eval_ds = split_ds["test"]

        def preprocess_fn(examples):
            return tokenizer(examples["text"], truncation=True, padding="max_length", max_length=128)

        train_ds = train_ds.map(preprocess_fn, batched=True)
        eval_ds = eval_ds.map(preprocess_fn, batched=True)

        training_args = TrainingArguments(
            output_dir="./results",
            save_strategy="epoch",
            learning_rate=2e-5,
            per_device_train_batch_size=16,
            per_device_eval_batch_size=16,
            num_train_epochs=2,
            weight_decay=0.01,
            logging_dir="./logs",
            logging_steps=50,
            push_to_hub=False,
            load_best_model_at_end=False,
            fp16=True
        )

        trainer = Trainer(
            model=model,
            args=training_args,
            train_dataset=train_ds,
            eval_dataset=eval_ds,
            tokenizer=tokenizer,
            compute_metrics=compute_metrics
        )

        trainer.train()

        # è®­ç»ƒç»“æŸåä¿å­˜æ¨¡å‹ï¼Œæ–¹ä¾¿åç»­é¢„æµ‹ç”¨æœ€æ–°æ¨¡å‹
        trainer.save_model(model_dir)
        tokenizer.save_pretrained(model_dir)

        return "âœ… è®­ç»ƒå®Œæˆï¼Œæ¨¡å‹å·²æ›´æ–°"
    except Exception as e:
        return f"è®­ç»ƒå¤±è´¥ï¼Œé”™è¯¯ï¼š{e}"

# Gradio UI å¸ƒå±€
with gr.Blocks() as demo:
    gr.Markdown("# ä¸­æ–‡æƒ…æ„Ÿåˆ†ç±»å¾®è°ƒä¸é¢„æµ‹")
    
    with gr.Tab("é¢„æµ‹"):
        text_input = gr.Textbox(label="è¾“å…¥æ–‡æœ¬")
        pred_button = gr.Button("é¢„æµ‹æƒ…æ„Ÿ")
        pred_output = gr.Label()
        pred_button.click(predict, inputs=text_input, outputs=pred_output)
    
    with gr.Tab("å¾®è°ƒè®­ç»ƒ"):
        file_input = gr.File(label="ä¸Šä¼ è®­ç»ƒæ•°æ® CSVï¼ˆå« text, label åˆ—ï¼‰", file_types=[".csv"])
        train_button = gr.Button("å¼€å§‹å¾®è°ƒè®­ç»ƒ")
        train_output = gr.Textbox()
        train_button.click(train, inputs=file_input, outputs=train_output)

demo.launch(server_name="0.0.0.0", server_port=7860)

</code></pre>
<hr />
<h3 id="ä½¿ç”¨è¯´æ˜"><a class="header" href="#ä½¿ç”¨è¯´æ˜">ä½¿ç”¨è¯´æ˜</a></h3>
<ol>
<li><strong>å‡†å¤‡å¥½ä½ ä¹‹å‰è®­ç»ƒå¥½çš„æ¨¡å‹</strong>ï¼Œè·¯å¾„æ˜¯ <code>./my-chinese-sentiment</code>ã€‚</li>
<li>å®‰è£…ä¾èµ–ï¼š</li>
</ol>
<pre><code class="language-bash">pip install gradio transformers datasets evaluate torch pandas
</code></pre>
<ol start="3">
<li>è¿è¡Œï¼š</li>
</ol>
<pre><code class="language-bash">python app.py
</code></pre>
<ol start="4">
<li>
<p>æµè§ˆå™¨æ‰“å¼€è‡ªåŠ¨å¼¹å‡ºçš„é“¾æ¥æˆ–è®¿é—® <code>http://127.0.0.1:7860</code>ï¼Œä½ å°±èƒ½çœ‹åˆ°ç•Œé¢ã€‚</p>
</li>
<li>
<p><strong>é¢„æµ‹é¡µ</strong>ï¼šè¾“å…¥ä¸­æ–‡æ–‡æœ¬ç‚¹å‡»â€œé¢„æµ‹æƒ…æ„Ÿâ€ã€‚</p>
</li>
<li>
<p><strong>å¾®è°ƒè®­ç»ƒé¡µ</strong>ï¼šä¸Šä¼ åŒ…å« <code>text</code> å’Œ <code>label</code> çš„ CSV æ–‡ä»¶ï¼Œç‚¹å‡»â€œå¼€å§‹å¾®è°ƒè®­ç»ƒâ€ï¼Œè®­ç»ƒç»“æŸåæ¨¡å‹ä¼šè‡ªåŠ¨æ›´æ–°ã€‚</p>
</li>
</ol>
<hr />
<h3 id="æ³¨æ„"><a class="header" href="#æ³¨æ„">æ³¨æ„</a></h3>
<ul>
<li>è®­ç»ƒä¼šä½¿ç”¨ä½ çš„å½“å‰ç¡¬ä»¶ï¼ˆæœ€å¥½æœ‰ GPUï¼‰ã€‚</li>
<li>è®­ç»ƒæ—¶é—´è§†æ•°æ®é‡å’Œæœºå™¨æ€§èƒ½è€Œå®šã€‚</li>
<li>è®­ç»ƒè¿‡ç¨‹çš„æ—¥å¿—ä¼šè¾“å‡ºåˆ°æ§åˆ¶å°ã€‚</li>
<li>è¿™ä¸ªç•Œé¢ç¤ºä¾‹ç®€å•ç›´è§‚ï¼Œä½ å¯ä»¥æ ¹æ®éœ€æ±‚è‡ªè¡Œæ‰©å±•ã€‚</li>
</ul>
<hr />
<p>å®‰è£… sudoã€‚
ç¡®ä¿æœåŠ¡å™¨æœ¬èº«æ²¡æœ‰é¢å¤–é˜²ç«å¢™é™åˆ¶
è¿è¡Œå‘½ä»¤æ£€æŸ¥ï¼ˆUbuntu å¸¸è§æ˜¯ ufwï¼‰ï¼š</p>
<hr />
<h2 id="ubuntudebian-ç³»ç»Ÿå®‰è£…-ufw"><a class="header" href="#ubuntudebian-ç³»ç»Ÿå®‰è£…-ufw">Ubuntu/Debian ç³»ç»Ÿå®‰è£… ufw</a></h2>
<pre><code class="language-bash">apt update
apt install ufw
</code></pre>
<hr />
<p>è¿è¡Œ</p>
<pre><code class="language-bash">ufw status
</code></pre>
<p>å¦‚æœæç¤º <code>command not found</code>ï¼Œ<code>Status: inactive</code>è¯´æ˜ç³»ç»Ÿæ²¡å®‰è£… <code>ufw</code>ã€‚</p>
<ol>
<li>ç”¨éš§é“å·¥å…·ï¼ˆæ¨èï¼‰
é€šè¿‡éš§é“å·¥å…·æš´éœ² Gradio ç«¯å£ï¼Œå®ç°æœ¬åœ°æµè§ˆå™¨è®¿é—®ã€‚</li>
</ol>
<p>å¸¸ç”¨å·¥å…·
ngrokï¼ˆéœ€æ³¨å†Œï¼‰</p>
<p>cloudflaredï¼ˆCloudflare æä¾›ï¼‰</p>
<p>frpï¼ˆéœ€è¦ä½ è‡ªå·±çš„å…¬ç½‘æœåŠ¡å™¨åšè·³æ¿ï¼‰</p>
<ol start="2">
<li>ngrok ç®€å•ä½¿ç”¨ç¤ºèŒƒ
ä¸‹è½½å¹¶å®‰è£… ngrokï¼š</li>
</ol>
<hr />
<h2 id="ä¸€å‡†å¤‡å·¥ä½œ"><a class="header" href="#ä¸€å‡†å¤‡å·¥ä½œ">ä¸€ã€å‡†å¤‡å·¥ä½œ</a></h2>
<ol>
<li>
<p>æ³¨å†Œ <a href="https://ngrok.com/">ngrok å®˜ç½‘</a> å¹¶ç™»å½•ï¼Œè¿›å…¥ Dashboard è·å–ä½ çš„ <strong>Authtoken</strong>ã€‚</p>
</li>
<li>
<p>äº‘IDE é‡Œä¸‹è½½å¹¶è§£å‹ ngrokï¼š</p>
</li>
</ol>
<pre><code class="language-bash">wget https://bin.equinox.io/c/4VmDzA7iaHb/ngrok-stable-linux-amd64.zip
unzip ngrok-stable-linux-amd64.zip
chmod +x ngrok
./ngrok version
</code></pre>
<hr />
<h2 id="æ­£ç¡®ä¸‹è½½æœ€æ–°-ngrok-ç‰ˆæœ¬çš„æ–¹æ³•"><a class="header" href="#æ­£ç¡®ä¸‹è½½æœ€æ–°-ngrok-ç‰ˆæœ¬çš„æ–¹æ³•">æ­£ç¡®ä¸‹è½½æœ€æ–° ngrok ç‰ˆæœ¬çš„æ–¹æ³•</a></h2>
<p>ngrok æœ€æ–°ç‰ˆæœ¬æ˜¯ 3.xï¼Œå®˜æ–¹æœ€æ–° Linux 64ä½ä¸‹è½½åœ°å€ï¼š</p>
<pre><code class="language-bash">wget https://bin.equinox.io/c/bNyj1mQVY4c/ngrok-v3-stable-linux-amd64.tgz -O ngrok.tgz
tar -xzf ngrok.tgz
chmod +x ngrok
./ngrok version
</code></pre>
<hr />
<p>æ‰§è¡Œå®Œåï¼Œè®¤è¯ token ï¼š</p>
<pre><code class="language-bash">./ngrok authtoken &lt;ä½ çš„token&gt;
</code></pre>
<h2 id="å…¬ç½‘è®¿é—®ä¸éš§é“å·¥å…·-ngrok"><a class="header" href="#å…¬ç½‘è®¿é—®ä¸éš§é“å·¥å…·-ngrok">å…¬ç½‘è®¿é—®ä¸éš§é“å·¥å…·-ngrok</a></h2>
<hr />
<h3 id="æ‰§è¡Œ"><a class="header" href="#æ‰§è¡Œ">æ‰§è¡Œ</a></h3>
<ol>
<li>å…ˆè¿è¡Œä½ çš„ Gradio æœåŠ¡ï¼š</li>
</ol>
<pre><code class="language-bash">python app.py
</code></pre>
<p>ç¡®è®¤å®ƒåœ¨è¿è¡Œï¼Œå¹¶ä¸”è¾“å‡ºç±»ä¼¼ï¼š</p>
<pre><code>Running on local URL:  http://0.0.0.0:7860
</code></pre>
<ol start="2">
<li>åœ¨å¦ä¸€ä¸ªç»ˆç«¯çª—å£ï¼Œå¯åŠ¨ ngrok éš§é“ï¼š</li>
</ol>
<pre><code class="language-bash">./ngrok http 7860
</code></pre>
<ol start="3">
<li>å¤åˆ¶ ngrok æ˜¾ç¤ºçš„å…¬ç½‘åœ°å€ï¼Œç”¨æµè§ˆå™¨è®¿é—®ï¼Œå°±èƒ½çœ‹åˆ°ä½ çš„ Gradio é¡µé¢ã€‚</li>
</ol>
<p>---ã€‚</p>
<h2 id="æ€»ç»“ä¸æ‰©å±•"><a class="header" href="#æ€»ç»“ä¸æ‰©å±•">æ€»ç»“ä¸æ‰©å±•</a></h2>
<ul>
<li>æœ¬æ–‡æ¼”ç¤ºäº†ä¸­æ–‡æƒ…æ„Ÿåˆ†ç±»æ¨¡å‹çš„å®Œæ•´å¾®è°ƒä¸éƒ¨ç½²æµç¨‹</li>
<li>ä»‹ç»äº†å¦‚ä½•è§£å†³äº‘æœåŠ¡å™¨ç«¯å£è®¿é—®é™åˆ¶é—®é¢˜</li>
<li>åç»­å¯å°è¯• Docker å®¹å™¨åŒ–éƒ¨ç½²ã€æ­å»ºæ›´å¤æ‚çš„åœ¨çº¿æœåŠ¡æ¥å£</li>
<li>ngrok å…è´¹è´¦å·çš„å…¬ç½‘åœ°å€æ˜¯ä¸´æ—¶éšæœºçš„ï¼Œé‡å¯åä¼šå˜åŒ–ã€‚</li>
<li>å»ºè®®åªç”¨äºè°ƒè¯•ã€ä¸´æ—¶è®¿é—®ã€‚</li>
</ul>
<hr />
<h2 id="é¡¹ç›®æ–‡ä»¶ç»“æ„"><a class="header" href="#é¡¹ç›®æ–‡ä»¶ç»“æ„">é¡¹ç›®æ–‡ä»¶ç»“æ„</a></h2>
<pre><code>/workspace/
â”œâ”€â”€ data/
â”‚   â””â”€â”€ chnsenticorp.csv       # ä¸­æ–‡æƒ…æ„Ÿåˆ†ç±»æ•°æ®CSV
â”œâ”€â”€ my-chinese-sentiment/      # è®­ç»ƒåæ¨¡å‹æ–‡ä»¶å¤¹
â”‚   â”œâ”€â”€ config.json
â”‚   â”œâ”€â”€ pytorch_model.bin
â”‚   â”œâ”€â”€ tokenizer.json
â”‚   â””â”€â”€ ...
â”œâ”€â”€ app.py                     # Gradio å¯åŠ¨è„šæœ¬
â”œâ”€â”€ finetune_sentiment.py      # å¾®è°ƒè®­ç»ƒè„šæœ¬
â”œâ”€â”€ ngrok                      # ngrok å¯æ‰§è¡Œæ–‡ä»¶
â”œâ”€â”€ ngrok.tgz                  # ngrok å‹ç¼©åŒ…
â””â”€â”€ start_gradio_with_ngrok.py # ï¼ˆå¯é€‰ï¼‰è‡ªåŠ¨å¯åŠ¨Gradioå’Œngrokè„šæœ¬
</code></pre>
<hr />

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../TX/intro.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../TX/ubuntu.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../TX/intro.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../TX/ubuntu.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <!-- Livereload script (if served using the cli tool) -->
        <script>
            const wsProtocol = location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsAddress = wsProtocol + "//" + location.host + "/" + "__livereload";
            const socket = new WebSocket(wsAddress);
            socket.onmessage = function (event) {
                if (event.data === "reload") {
                    socket.close();
                    location.reload();
                }
            };

            window.onbeforeunload = function() {
                socket.close();
            }
        </script>



        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../theme/extra.js"></script>
        <script src="../theme/pagetoc.js"></script>



    </div>
    </body>
</html>
