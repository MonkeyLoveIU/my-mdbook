
# ğŸŒ² KD æ ‘å…¨è§£ï¼šåŸç† + åº”ç”¨ + Python å®ç°

## ğŸ“Œ å¼•è¨€

åœ¨å¤„ç†é«˜ç»´ç©ºé—´ä¸­çš„\*\*æœ€è¿‘é‚»æŸ¥æ‰¾ï¼ˆNearest Neighbor Searchï¼‰\*\*é—®é¢˜æ—¶ï¼Œæš´åŠ›æœç´¢æ•ˆç‡ä½ä¸‹ã€‚æ­¤æ—¶ï¼Œ**KD æ ‘**ï¼ˆK-D Treeï¼‰æ˜¯ä¸€ç§éå¸¸æœ‰æ•ˆçš„è§£å†³æ–¹æ¡ˆã€‚

KD æ ‘å¹¿æ³›åº”ç”¨äºï¼š

* ğŸ“ ç©ºé—´ç´¢å¼•
* ğŸ¯ KNN æŸ¥è¯¢åŠ é€Ÿ
* ğŸ“· å›¾åƒè¯†åˆ«ä¸æ£€ç´¢
* ğŸ® æ¸¸æˆåœºæ™¯ç¢°æ’æ£€æµ‹

---

## ğŸ“ 1. ä»€ä¹ˆæ˜¯ KD æ ‘ï¼Ÿ

KD æ ‘æ˜¯ä¸€ç§å¯¹**kç»´ç©ºé—´æ•°æ®è¿›è¡Œåˆ†å‰²çš„äºŒå‰æ ‘ç»“æ„**ï¼Œç”¨äºåŠ é€Ÿ**å¤šç»´ç©ºé—´çš„æœç´¢æ“ä½œ**ã€‚å…¶æ ¸å¿ƒæ€æƒ³æ˜¯ï¼š

> é€šè¿‡åœ¨ä¸åŒç»´åº¦ä¸Šè½®æµåˆ‡åˆ†ç©ºé—´ï¼Œå½¢æˆä¸€æ£µå¹³è¡¡çš„æ ‘çŠ¶ç»“æ„ï¼ŒåŠ é€Ÿâ€œèŒƒå›´æŸ¥æ‰¾â€ä¸â€œæœ€è¿‘é‚»æŸ¥æ‰¾â€ã€‚

---

## ğŸ§  2. KD æ ‘çš„æ„å»ºåŸç†

### ğŸŒ¿ æ„å»ºè¿‡ç¨‹ï¼š

1. ä»æ‰€æœ‰æ•°æ®ä¸­é€‰æ‹©ä¸€ä¸ªâ€œä¸­ä½æ•°â€ï¼Œä½œä¸ºå½“å‰èŠ‚ç‚¹ï¼ˆæŒ‰æŸä¸€ç»´åº¦ï¼‰
2. å·¦å­æ ‘ä¿å­˜è¯¥ç»´åº¦å°äºä¸­ä½æ•°çš„æ ·æœ¬
3. å³å­æ ‘ä¿å­˜å¤§äºç­‰äºä¸­ä½æ•°çš„æ ·æœ¬
4. é€’å½’å¯¹å·¦å³å­æ ‘è¿›è¡Œæ„å»ºï¼Œåˆ‡æ¢ä¸‹ä¸€ä¸ªç»´åº¦

### ğŸ” åˆ†è£‚ç»´åº¦é€‰æ‹©ï¼š

* é€šå¸¸æŒ‰ç…§ç»´åº¦é¡ºåºå¾ªç¯ï¼šx â†’ y â†’ z â†’ x â†’ ...
* ä¹Ÿå¯ä»¥æ ¹æ®æœ€å¤§æ–¹å·®çš„ç»´åº¦æ¥é€‰æ‹©ï¼ˆæå‡å¹³è¡¡æ€§ï¼‰

---

## ğŸ§ª 3. Python æ‰‹åŠ¨å®ç° KD æ ‘

æˆ‘ä»¬ä»é›¶å®ç°ä¸€ä¸ªäºŒç»´ KD æ ‘æ„å»ºä¸æŸ¥è¯¢çš„ç®€ç‰ˆï¼ˆé€‚ç”¨äºæ•™å­¦ï¼‰ï¼š

### ğŸ”§ 3.1 æ„å»º KD æ ‘

```python
class Node:
    def __init__(self, point, axis, left=None, right=None):
        self.point = point
        self.axis = axis  # å½“å‰åˆ‡åˆ†çš„ç»´åº¦
        self.left = left
        self.right = right

def build_kdtree(points, depth=0):
    if not points:
        return None

    k = len(points[0])  # ç»´åº¦
    axis = depth % k
    points.sort(key=lambda x: x[axis])
    median = len(points) // 2

    return Node(
        point=points[median],
        axis=axis,
        left=build_kdtree(points[:median], depth + 1),
        right=build_kdtree(points[median + 1:], depth + 1)
    )
```

---

### ğŸ” 3.2 KD æ ‘æœ€è¿‘é‚»æœç´¢

```python
def distance_squared(p1, p2):
    return sum((a - b) ** 2 for a, b in zip(p1, p2))

def nearest_neighbor(node, target, best=None):
    if node is None:
        return best

    if best is None or distance_squared(target, node.point) < distance_squared(target, best):
        best = node.point

    axis = node.axis
    diff = target[axis] - node.point[axis]

    # ä¼˜å…ˆæœç´¢ç¦»ç›®æ ‡æ›´è¿‘çš„å­æ ‘
    next_branch = node.left if diff < 0 else node.right
    best = nearest_neighbor(next_branch, target, best)

    # æ˜¯å¦æœ‰å¿…è¦æœç´¢å¦ä¸€è¾¹
    if diff ** 2 < distance_squared(target, best):
        other_branch = node.right if diff < 0 else node.left
        best = nearest_neighbor(other_branch, target, best)

    return best
```

---

### âœ… ç¤ºä¾‹æµ‹è¯•

```python
points = [(2, 3), (5, 4), (9, 6), (4, 7), (8, 1), (7, 2)]
tree = build_kdtree(points)
target = (9, 2)

nn = nearest_neighbor(tree, target)
print("æœ€è¿‘é‚»:", nn)
```

è¾“å‡ºç¤ºä¾‹ï¼š

```
æœ€è¿‘é‚»: (8, 1)
```

---

## ğŸ§° 4. Scikit-Learn ä¸­çš„ KD æ ‘

Scikit-Learn æä¾›äº†ä¼˜åŒ–ç‰ˆæœ¬çš„ KDTree å’Œ BallTreeï¼š

```python
from sklearn.neighbors import KDTree
import numpy as np

X = np.array([[2, 3], [5, 4], [9, 6], [4, 7], [8, 1], [7, 2]])
tree = KDTree(X)

# æŸ¥è¯¢ç‚¹ [9,2] æœ€è¿‘çš„1ä¸ªç‚¹
dist, ind = tree.query([[9, 2]], k=1)
print("æœ€è¿‘é‚»ç‚¹ç´¢å¼•ï¼š", ind, "è·ç¦»ï¼š", dist)
print("æœ€è¿‘é‚»ç‚¹åæ ‡ï¼š", X[ind])
```

---

## ğŸ§  5. KD æ ‘é€‚ç”¨æ€§ä¸é™åˆ¶

| ä¼˜åŠ¿         | å±€é™             |
| ---------- | -------------- |
| æŸ¥è¯¢æ•ˆç‡è¿œä¼˜äºæš´åŠ›  | é«˜ç»´ç©ºé—´ï¼ˆ>20ç»´ï¼‰æ€§èƒ½é€€åŒ– |
| å†…å­˜å ç”¨å°      | ä¸èƒ½å¤„ç†åŠ¨æ€å¢åˆ ç‚¹      |
| æ”¯æŒèŒƒå›´æŸ¥è¯¢ã€KNN | ç©ºé—´åˆ†å¸ƒä¸å‡å½±å“å¹³è¡¡æ€§    |

ğŸ“Œ KD æ ‘æ›´é€‚ç”¨äº **ä½ç»´ç¨ å¯†æ•°æ®** çš„æœ€è¿‘é‚»é—®é¢˜ï¼ˆå¦‚ 2D/3D å›¾åƒã€åœ°ç†åæ ‡ç­‰ï¼‰ã€‚

---

## ğŸŒŸ 6. æ‹“å±•é˜…è¯»ä¸æ›¿ä»£æ–¹æ¡ˆ

* **Ball Tree**ï¼šé€‚ç”¨äºé«˜ç»´åº¦ï¼Œæ›´å…·æ‰©å±•æ€§
* **Annoy / Faiss / HNSW**ï¼šå¤§è§„æ¨¡å‘é‡æ£€ç´¢å·¥å…·ï¼Œé€‚ç”¨äºä¸Šç™¾ä¸‡å‘é‡çš„æœç´¢
* **LSH (å±€éƒ¨æ•æ„Ÿå“ˆå¸Œ)**ï¼šé€‚åˆä½™å¼¦ç›¸ä¼¼åº¦æˆ–æ±‰æ˜è·ç¦»

---

## ğŸ§¾ æ€»ç»“

KD æ ‘æ˜¯ä¸€ç§ç»å…¸çš„ç©ºé—´åˆ†å‰²æœç´¢ç»“æ„ï¼Œé€‚ç”¨äºï¼š

* KNN æœç´¢åŠ é€Ÿ
* å›¾åƒè¯†åˆ«/æ£€ç´¢
* èšç±»åˆå§‹ä¸­å¿ƒç‚¹é€‰å–ï¼ˆå¦‚ KMeans++ï¼‰

---